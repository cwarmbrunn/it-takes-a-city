<%- include('partials/header') -%>

  <% if (locals.isAuthenticated) { %>
    <div class="AboutUs margin-left: 0px;">
      <h1 class="italic">About Us</h1>
      <p class="pt-1">These are food bank locations you can add them and their addresses, any post help people in need,
        Thanks!</p>
    </div>
    <div class="posts space-y-11">
    </div>
    <% } %>

      <%- include('partials/footer') -%>
        <script>
          function getPosts() {
            var requestUrl = "http://localhost:3000/api/posts/"
            fetch(requestUrl)
              .then(function (response) {
                return response.json();
              })
              .then((data) => generatePosts(data));
          }

          function generatePosts(data) {
            var postContainer = document.createElement("div");
            for (i = 0; i < data.length; i++) {
                  //Using console.log to examine the data
                  console.log(data[i].title);
                  var locationAddress = document.createElement("h2");
                  var userPost = document.createElement("p");
                  var locationName = document.createElement("h1");
                  userPost.classList.add("text-base", "bold", "border-b", "border-gray-400");
                  locationAddress.classList.add("italic", "text-base");
                  //Setting the text of the h3 element and p element.
                  locationAddress.textContent = data[i].title;
                  locationName.textContent = data[i].content;
                  userPost.textContent = data[i].user.username;
                  //Appending the dynamically generated html to the div associated with the id="users"
                  //Append will attach the element as the bottom most child.
                  console.log(locationAddress, userPost, locationName);
                  postContainer.append(locationAddress);
                  postContainer.append(locationName);
                  postContainer.append(userPost);
                  for (x = 0; x < data[i].comments.length; x++) {
                    console.log(i , x, data[i].comments.length);
                    console.log(data[i].comments[x].comment_text, data[i].comments[x].user.username);
                    var comments = document.createElement("p");
                    var userNameComment = document.createElement("p");
                    comments.classList.add('comments', "ml-10", "text-base");
                    userNameComment.classList.add('userNameComments', 'ml-10', "text-lg", "border-b", "border-gray-400");
                    comments.textContent = data[i].comments[x].comment_text;
                    userNameComment.textContent = data[i].comments[x].user.username;
                    postContainer.append(comments);
                    postContainer.append(userNameComment);
                  }
                  var allPostsContainer = document.querySelector(".posts");
                  allPostsContainer.append(postContainer);
                }
            }
          
          getPosts();
        </script>